(this["webpackJsonptinv-pwa"]=this["webpackJsonptinv-pwa"]||[]).push([[0],{129:function(e,t,a){e.exports=a(261)},134:function(e,t,a){},136:function(e,t,a){},141:function(e,t,a){},142:function(e,t,a){},143:function(e,t,a){},144:function(e,t,a){},145:function(e,t,a){},201:function(e,t,a){},259:function(e,t,a){},260:function(e,t,a){},261:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(16),c=a.n(i),o=(a(134),a(26)),u=a(10),s=a.n(u),l=a(21),d=a(8),m=a(9),p=a(11),v=a(12),f=a(7);function h(){return localStorage.getItem("API_TOKEN")}function y(e,t){return E.apply(this,arguments)}function E(){return(E=Object(l.a)(s.a.mark((function e(t,a){var r,n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="figi=".concat(t,"&from=").concat(a.toISOString(),"&to=").concat((new Date).toISOString(),"&interval=day"),e.next=3,fetch("https://api-invest.tinkoff.ru/openapi/market/candles?".concat(r),{headers:{accept:"application/json",Authorization:"Bearer ".concat(h())}});case 3:return n=e.sent,e.next=6,n.json();case 6:return i=e.sent,e.abrupt("return",i.payload.candles);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,t){var a=function(e,t,a,r){if(0!==e.length){var n=null!==a&&void 0!==a?a:0,i=null!==r&&void 0!==r?r:e.length-1;if(!(t<new Date(e[n].time))){if(new Date(e[i].time)<=t)return i;for(;;){if(i-n<2)return n;var c=n+((i-n)/2|0),o=new Date(e[c].time);if(o<t)n=c;else{if(!(o>t))return c;i=c}}}}}(e,t);if(void 0!==a)return e[a].c}function w(e){if(0===e.length)throw Error("No candles");return e[e.length-1].c}var g=a(25);function P(e){return k.apply(this,arguments)}function k(){return(k=Object(l.a)(s.a.mark((function e(t){var a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api-invest.tinkoff.ru/openapi/market/".concat(t),{headers:{accept:"application/json",Authorization:"Bearer ".concat(h())}});case 2:return a=e.sent,e.next=5,a.json();case 5:return r=e.sent,e.abrupt("return",r.payload.instruments);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return O.apply(this,arguments)}function O(){return(O=Object(l.a)(s.a.mark((function e(){var t,a,r,n,i,c,o,u,l,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=P("stocks"),a=P("bonds"),r=P("etfs"),n=P("currencies"),e.next=6,t;case 6:return i=e.sent,e.next=9,a;case 9:return c=e.sent,e.next=12,r;case 12:return o=e.sent,e.next=15,n;case 15:return u=e.sent,l=[].concat(Object(g.a)(i),Object(g.a)(c.map((function(e){return e.type="Bond",e}))),Object(g.a)(o.map((function(e){return e.type="Etf",e}))),Object(g.a)(u.map((function(e){return e.type="Currency",e})))),d={},l.forEach((function(e){d[e.figi]=e})),e.abrupt("return",d);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return U.apply(this,arguments)}function U(){return(U=Object(l.a)(s.a.mark((function e(){var t,a,r,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URL("/openapi/operations","https://api-invest.tinkoff.ru")).searchParams.set("from","1900-01-01T00:00:00Z"),t.searchParams.set("to",(new Date).toISOString()),e.next=5,fetch(t.toString(),{headers:{accept:"application/json",Authorization:"Bearer ".concat(h())}});case 5:return a=e.sent,e.next=8,a.json();case 8:return r=e.sent,(n=r.payload.operations).sort((function(e,t){var a=new Date(e.date),r=new Date(t.date);return a>r?1:a<r?-1:0})),e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(136);var j=a(39),T=a(18),C=a(17);function N(e,t,a,r){if("RUB"===e)return t;if("USD"===e)return t*a;if("EUR"===e)return t*r;throw Error("Unknown currency")}function R(e,t,a,r){if("RUB"===e)return t/a;if("USD"===e)return t;if("EUR"===e)return t*r/a;throw Error("Unknown currency")}function x(e,t,a,r){if("RUB"===e)return t/r;if("USD"===e)return t*a/r;if("EUR"===e)return t;throw Error("Unknown currency")}function F(e,t,a,r,n){return"RUB"===e?N(t,a,r,n):"USD"===e?R(t,a,r,n):x(t,a,r,n)}var B=function(){function e(t,a){Object(d.a)(this,e),this.usdCost=void 0,this.eurCost=void 0,this.rubTotal=0,this.usdCost=t,this.eurCost=a}return Object(m.a)(e,[{key:"add",value:function(e,t){return"RUB"===e&&(this.rubTotal+=t),"USD"===e&&(this.rubTotal+=t*this.usdCost),"EUR"===e&&(this.rubTotal+=t*this.eurCost),this}},{key:"addRub",value:function(e){return this.rubTotal+=e,this}},{key:"addUsd",value:function(e){return this.rubTotal+=e*this.usdCost,this}},{key:"addEur",value:function(e){return this.rubTotal+=e*this.eurCost,this}},{key:"rub",value:function(){return this.rubTotal}},{key:"usd",value:function(){return this.rubTotal/this.usdCost}},{key:"eur",value:function(){return this.rubTotal/this.eurCost}},{key:"cur",value:function(e){return"RUB"===e?this.rub():"USD"===e?this.usd():this.eur()}}]),e}();function I(e,t,a,r){return Object.values(e).sort((function(e,n){var i,c,o=Math.abs(N(n.currency,n.amount*n.price,a,r))-Math.abs(N(e.currency,e.amount*e.price,a,r));if(0!==o)return o;var u=null===(i=t[e.figi])||void 0===i?void 0:i.ticker,s=null===(c=t[n.figi])||void 0===c?void 0:c.ticker;if(void 0===u||void 0===s)throw Error("Unknown instruments");return u.localeCompare(s)}))}function M(e){var t=[];if("string"===typeof e)t.push(e);else{var a,r=Object(o.a)(e);try{for(r.s();!(a=r.n()).done;){var n=a.value;t.push(n)}}catch(m){r.e(m)}finally{r.f()}}for(var i=arguments.length,c=new Array(i>1?i-1:0),u=1;u<i;u++)c[u-1]=arguments[u];for(var s=0,l=c;s<l.length;s++){var d=l[s];d[0]&&t.push(d[1])}return t.join(" ")}a(141);var A=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.props.currency;return n.a.createElement("div",{className:"cCurrenciesSwitch"},n.a.createElement("div",{className:M("",["RUB"===t,"active"]),onClick:function(){return e.props.onCurSwitch("RUB")}},"\u0432 \u0420\u0443\u0431\u043b\u044f\u0445"),n.a.createElement("div",{className:M("",["USD"===t,"active"]),onClick:function(){return e.props.onCurSwitch("USD")}},"\u0432 \u0414\u043e\u043b\u043b\u0430\u0440\u0430\u0445"),n.a.createElement("div",{className:M("",["EUR"===t,"active"]),onClick:function(){return e.props.onCurSwitch("EUR")}},"\u0432 \u0415\u0432\u0440\u043e"))}}]),a}(n.a.Component),G=(a(142),function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.drawAllTime,a=e.drawDay1,r=e.drawDay7,i=e.drawDay30,c=e.setFlags;return n.a.createElement("div",{className:"cDaysSwitch"},n.a.createElement("div",{className:M("all-time-switch",[t,"active"]),onClick:function(){return c(!t,a,r,i)}},n.a.createElement("div",{className:M("all-time-mark",[t,"active"])}),"\u0437\u0430 \u0432\u0441\u0435 \u0432\u0440\u0435\u043c\u044f"),n.a.createElement("div",{className:"radio-switch"},n.a.createElement("div",{className:M("",[a,"active"]),onClick:function(){return c(t,!0,!1,!1)}},"\u0437\u0430 \u0434\u0435\u043d\u044c"),n.a.createElement("div",{className:M("",[r,"active"]),onClick:function(){return c(t,!1,!0,!1)}},"\u0437\u0430 7 \u0434\u043d\u0435\u0439"),n.a.createElement("div",{className:M("",[i,"active"]),onClick:function(){return c(t,!1,!1,!0)}},"\u0437\u0430 30 \u0434\u043d\u0435\u0439")))}}]),a}(n.a.Component)),J=a(65);a(104),a(143);function H(e){return(Math.round(100*e)/100).toLocaleString("ru-RU")}var L=function(e){var t=M("currency rub",[e.v>0,"positive"],[e.v<0,"negative"],[!0===e.color,"color"]);return n.a.createElement("span",{className:t},"\u20bd"," ",H(e.v))},z=function(e){var t=M("currency usd",[e.v>0,"positive"],[e.v<0,"negative"],[!0===e.color,"color"]);return n.a.createElement("span",{className:t},"$ ",H(e.v))},W=function(e){var t=M("currency eur",[e.v>0,"positive"],[e.v<0,"negative"],[!0===e.color,"color"]);return n.a.createElement("span",{className:t},"\u20ac"," ",H(e.v))},q=function(e){var t=e.t,a=e.v;return"RUB"===t?n.a.createElement(L,{v:a,color:e.color}):"USD"===t?n.a.createElement(z,{v:a,color:e.color}):n.a.createElement(W,{v:a,color:e.color})},$=function(e){var t=M("percent",[e.v>0,"positive"],[e.v<0,"negative"],[!0===e.color,"color"]);return n.a.createElement("span",{className:t},H(100*e.v),"%")};function K(e){return e.getFullYear().toString()}function Y(e){return["\u042f\u043d\u0432","\u0424\u0435\u0432","\u041c\u0430\u0440","\u0410\u043f\u0440","\u041c\u0430\u0439","\u0418\u044e\u043d\u044c","\u0418\u044e\u043b\u044c","\u0410\u0432\u0433","\u0421\u0435\u043d","\u041e\u043a\u0442","\u041d\u043e\u044f","\u0414\u0435\u043a"][e.getMonth()]}function _(e){var t=e.getDate();return t<10?"0".concat(t):t.toString()}function Z(e){var t=e.getHours();return t<10?"0".concat(t):t.toString()}var Q=[{timeGap:31536e3,regularFormat:K},{timeGap:2419200,regularFormat:Y,yearGapFormat:function(e){return"".concat(Y(e),"\n").concat(K(e))}},{timeGap:86400,regularFormat:_,yearGapFormat:function(e){return"".concat(_(e),"\n").concat(K(e),", ").concat(Y(e))},monthGapFormat:function(e){return"".concat(_(e),"\n").concat(Y(e))}},{timeGap:3600,regularFormat:Z,dayGapFormat:function(e){return"".concat(Z(e),"\n").concat(_(e)," ").concat(Y(e))},yearGapFormat:function(e){return"".concat(Z(e),"\n").concat(_(e)," ").concat(Y(e)," ").concat(K(e))}},{timeGap:60,regularFormat:function(e){return f.DateTime.fromJSDate(e).toFormat("HH:mm")},dayGapFormat:function(e){return"".concat(f.DateTime.fromJSDate(e).toFormat("HH:mm"),"\n").concat(_(e)," ").concat(Y(e)," ").concat(K(e))}},{timeGap:1,regularFormat:function(e){return f.DateTime.fromJSDate(e).toFormat("HH:mm:ss")},dayGapFormat:function(e){return"".concat(f.DateTime.fromJSDate(e).toFormat("HH:mm:ss"),"\n").concat(_(e)," ").concat(Y(e)," ").concat(K(e))}},{timeGap:0,regularFormat:function(e){return f.DateTime.fromJSDate(e).toFormat("HH:mm:ss.SSS")},dayGapFormat:function(e){return"".concat(f.DateTime.fromJSDate(e).toFormat("HH:mm:ss.SSS"),"\n").concat(_(e)," ").concat(Y(e)," ").concat(K(e))}}];function V(e,t){var a=Math.ceil(1e3*(t[1]-t[0]))/1e3,r=Q.find((function(e){return a>=e.timeGap}));if(void 0===r)throw Error("Too small gap");var n=null,i=null,c=null;return t.map((function(e){var t=new Date(1e3*e),a=t.getFullYear(),o=t.getMonth(),u=t.getDate(),s=a!==n,l=o!==i,d=u!==c;return n=a,i=o,c=u,s&&void 0!==r.yearGapFormat?r.yearGapFormat(t):l&&void 0!==r.monthGapFormat?r.monthGapFormat(t):d&&void 0!==r.dayGapFormat?r.dayGapFormat(t):r.regularFormat(t)}))}function X(e,t){if("PERCENT"===t)return e.toFixed(0)+"%";var a={RUB:"\u20bd",USD:"$",EUR:"\u20ac"}[t];return e>1e6?"".concat(a).concat((e/1e6).toFixed(0),"\u043c"):e>1e3?"".concat(a).concat((e/1e3).toFixed(0),"\u0442"):e>100?"".concat(a).concat(function(e,t){return Math.round(10*e*t)/(10*t)}(e/1e3,1),"\u0442"):"".concat(a).concat(e.toFixed(0))}var ee=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(d.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).uplot=null,e.el=null,e.interval=null,e.resizeListener=function(){null!==e.el&&null!==e.uplot&&e.uplot.setSize({width:e.el.clientWidth,height:300})},e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=this;if(null===this.el)throw Error("No element?");window.addEventListener("resize",this.resizeListener),this.setupUPlot(),this.interval=window.setInterval((function(){var t;return null===(t=e.uplot)||void 0===t?void 0:t.syncRect()}),500)}},{key:"setupUPlot",value:function(){var e=this;if(null!==this.el){null!==this.uplot&&(this.uplot.destroy(),this.uplot=null);var t=this.props,a=t.s1,r=t.s2,n=t.s3,i=t.s4,c=[this.props.timestamps,a.data],o={width:2,value:function(t,a){return r=a,"PERCENT"===(n=e.props.valType)?r.toFixed(2)+"%":"".concat({RUB:"\u20bd",USD:"$",EUR:"\u20ac"}[n]," ").concat(H(r));var r,n}},u=[{label:"\u0414\u0430\u0442\u0430",value:function(e,t){var a=new Date(1e3*t);return"".concat(_(a)," ").concat(Y(a)," ").concat(K(a))}},Object(j.a)({},o,{label:a.label,stroke:"#003f5c",fill:"#003f5c30"})];void 0!==r&&(c.push(r.data),u.push(Object(j.a)({},o,{label:r.label,stroke:"#7a5195",fill:"#7a519530"}))),void 0!==n&&(c.push(n.data),u.push(Object(j.a)({},o,{label:n.label,stroke:"#ef5675",fill:"#ef567530"}))),void 0!==i&&(c.push(i.data),u.push({label:i.label,stroke:"#ffa600",fill:"#ffa60030"}));var s={width:this.el.clientWidth,height:300,series:u,fmtDate:function(){return function(){return""}},axes:[{values:V},{values:function(t,a){return a.map((function(t){return X(t,e.props.valType)}))}}]};this.uplot=new J.a(s,c,this.el)}}},{key:"componentDidUpdate",value:function(){this.setupUPlot()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeListener),null!==this.interval&&window.clearInterval(this.interval)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{ref:function(t){e.el=t}})}}]),a}(n.a.Component);a(144);function te(e){var t=e.rub;t+=e.usd*e.usdPrice,t+=e.eur*e.eurPrice;for(var a=0,r=Object.values(e.portfolio);a<r.length;a++){var n=r[a];t+=N(n.currency,n.amount*n.price,e.usdPrice,e.eurPrice)}return t}function ae(e){return e.ownRub+e.ownUsd*e.usdPrice+e.ownEur*e.eurPrice}var re=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state={drawAllTime:!0,drawDay1:!1,drawDay7:!1,drawDay30:!0,currency:"RUB",expandedDays:new Set},r}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.props.states,a=t.map((function(a,r){var n=t[Math.max(0,r-1)],i=t[Math.max(0,r-7)],c=t[Math.max(0,r-30)],o=F(e.state.currency,"RUB",te(a),a.usdPrice,a.eurPrice),u=F(e.state.currency,"RUB",ae(a),a.usdPrice,a.eurPrice),s=F(e.state.currency,"RUB",te(n),a.usdPrice,a.eurPrice),l=F(e.state.currency,"RUB",te(i),a.usdPrice,a.eurPrice),d=F(e.state.currency,"RUB",te(c),a.usdPrice,a.eurPrice),m=u-F(e.state.currency,"RUB",ae(n),a.usdPrice,a.eurPrice),p=u-F(e.state.currency,"RUB",ae(i),a.usdPrice,a.eurPrice),v=u-F(e.state.currency,"RUB",ae(c),a.usdPrice,a.eurPrice),f=(o-u)/o,h=(o-s-m)/o,y=(o-l-p)/o,E=(o-d-v)/o;return{date:a.date.getTime(),usdPrice:a.usdPrice,eurPrice:a.eurPrice,totalCur:o,totalOwnCur:u,added1:m,added7:p,added30:v,performance:f,performance1:h,performance7:y,performance30:E}})),r=Object(g.a)(t).reverse().slice(0,100),i=Object(g.a)(a).reverse().slice(0,100),c=this.state.drawDay1?"\u0417\u0430 \u0434\u0435\u043d\u044c":this.state.drawDay7?"\u0417\u0430 7 \u0434\u043d\u0435\u0439":"\u0417\u0430 30 \u0434\u043d\u0435\u0439",o=a.map((function(t){return e.state.drawDay1?100*t.performance1:e.state.drawDay7?100*t.performance7:100*t.performance30})),u=this.state.currency;return n.a.createElement("div",{className:"bHistory"},n.a.createElement(A,{currency:u,onCurSwitch:function(t){return e.setState({currency:t})}}),n.a.createElement("h1",null,"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u043f\u043e\u0440\u0442\u0444\u0435\u043b\u044f \u0438 \u0432\u043b\u043e\u0436\u0435\u043d\u0438\u044f"),n.a.createElement(ee,{timestamps:a.map((function(e){return e.date/1e3})),valType:u,s1:{label:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u043f\u043e\u0440\u0442\u0444\u0435\u043b\u044f",data:a.map((function(e){return e.totalCur}))},s2:{label:"\u0418\u043d\u0432\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e (\u0432\u044b\u0432\u0435\u0434\u0435\u043d\u043e)",data:a.map((function(e){return e.totalOwnCur}))}}),n.a.createElement("h1",null,"\u0414\u043e\u0445\u043e\u0434\u044b \u0438 \u043f\u043e\u0442\u0435\u0440\u0438"),n.a.createElement(G,{drawAllTime:this.state.drawAllTime,drawDay1:this.state.drawDay1,drawDay7:this.state.drawDay7,drawDay30:this.state.drawDay30,setFlags:function(t,a,r,n){return e.setState({drawAllTime:t,drawDay1:a,drawDay7:r,drawDay30:n})}}),this.state.drawAllTime?n.a.createElement(ee,{timestamps:a.map((function(e){return e.date/1e3})),valType:"PERCENT",s1:{label:c,data:o},s2:{label:"\u0417\u0430 \u0432\u0441\u0435 \u0432\u0440\u0435\u043c\u044f",data:a.map((function(e){return 100*e.performance}))}}):n.a.createElement(ee,{timestamps:a.map((function(e){return e.date/1e3})),valType:"PERCENT",s1:{label:c,data:o}}),n.a.createElement("div",null,r.map((function(t,a){return e.renderDayStats(t,i[a])}))))}},{key:"renderDayStats",value:function(e,t){var a=this,r=this.state.expandedDays.has(e.date.toISOString()),i=I(e.portfolio,this.props.instruments,e.usdPrice,e.eurPrice),c=new B(e.usdPrice,e.eurPrice).addRub(e.rub).addUsd(e.usd).addEur(e.eur).cur(this.state.currency),o=new B(e.usdPrice,e.eurPrice).addRub(e.ownRub).addUsd(e.ownUsd).addEur(e.ownEur).cur(this.state.currency);return n.a.createElement("div",{key:"day-".concat(e.date.toISOString()),className:"dayStats"},n.a.createElement("div",{className:"title"},n.a.createElement("span",{className:"date"},f.DateTime.fromJSDate(e.date).toISODate())," ","USD: ",n.a.createElement(L,{v:e.usdPrice})," ","EUR: ",n.a.createElement(L,{v:e.eurPrice})),n.a.createElement("div",{className:"avail"},"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e: ",n.a.createElement(q,{t:this.state.currency,v:c})),n.a.createElement("div",{className:"own"},"\u0418\u043d\u0432\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043e (\u0432\u044b\u0432\u0435\u0434\u0435\u043d\u043e): ",n.a.createElement(q,{t:this.state.currency,v:o})),n.a.createElement("div",{className:"portfolio"},i.filter((function(e){return 0!==e.amount})).map((function(t){return a.renderInstrument(t,a.state.currency,e.usdPrice,e.eurPrice)}))),n.a.createElement("div",{className:"total"},"\u0418\u0442\u043e\u0433\u043e: ",n.a.createElement(q,{t:this.state.currency,v:t.totalCur})," ","\u0417\u0430 \u0432\u0441\u0435 \u0432\u0440\u0435\u043c\u044f: ",n.a.createElement($,{v:t.performance,color:!0})," ","\u0417\u0430 \u0434\u0435\u043d\u044c: ",n.a.createElement($,{v:t.performance1,color:!0})," ","\u0417\u0430 7 \u0434\u043d\u0435\u0439: ",n.a.createElement($,{v:t.performance7,color:!0})," ","\u0417\u0430 30 \u0434\u043d\u0435\u0439: ",n.a.createElement($,{v:t.performance30,color:!0})),n.a.createElement("div",{className:M("ops-expander",[r,"expanded"]),onClick:function(){return a.flipExpandedDay(e.date)}},e.ops.length," \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439",e.ops.length>0?n.a.createElement("button",{onClick:function(){return a.flipExpandedDay(e.date)}},r?n.a.createElement("span",null,n.a.createElement(C.a,{icon:T.c})," \u0441\u043a\u0440\u044b\u0442\u044c"):n.a.createElement("span",null,n.a.createElement(C.a,{icon:T.a})," \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c")):void 0),r?n.a.createElement("div",{className:"ops"},e.ops.map((function(e,t){return a.renderOp(e,t.toString())}))):void 0)}},{key:"renderInstrument",value:function(e,t,a,r){var i=this.props.instruments[e.figi];if(void 0===i)throw Error("Instrument not found");return n.a.createElement("span",{key:"i-".concat(e.figi)},i.ticker,"(",e.amount,"):"," ",n.a.createElement(q,{t:t,v:F(t,e.currency,e.price*e.amount,a,r)}))}},{key:"renderOp",value:function(e,t){var a=Object(j.a)({},e);return void 0!==a.figi&&(a.instrument=this.props.instruments[a.figi]),n.a.createElement("pre",{key:t},JSON.stringify(a,void 0,2))}},{key:"flipExpandedDay",value:function(e){var t=new Set(this.state.expandedDays);t.has(e.toISOString())?t.delete(e.toISOString()):t.add(e.toISOString()),this.setState({expandedDays:t})}}]),a}(n.a.Component),ne=(a(145),function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state={token:""},r}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"bLoginForm"},n.a.createElement("div",{className:"description"},n.a.createElement("p",null,"\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u043d\u0430\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0432\u044b \u0442\u043e\u0440\u0433\u0443\u0435\u0442\u0435 \u0447\u0435\u0440\u0435\u0437 \u0441\u0435\u0440\u0432\u0438\u0441 \xab\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u0418\u043d\u0432\u0435\u0441\u0442\u0438\u0446\u0438\u0438\xbb."),n.a.createElement("p",null,"\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044e \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f API \u0442\u043e\u043a\u0435\u043d \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0447\u0442\u0435\u043d\u0438\u044f \u0432\u0430\u0448\u0438\u0445 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u2014 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043d\u0435 \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e \u0441\u043e\u0432\u0435\u0440\u0448\u0430\u0442\u044c \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u043d\u0430 \u0431\u0438\u0440\u0436\u0435. \u0422\u043e\u043a\u0435\u043d \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0447\u0442\u0435\u043d\u0438\u044f \u0438 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u043d\u0443\u0442\u0440\u0438 \u0432\u0430\u0448\u0435\u0433\u043e \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430, \u043a\u0430\u043a \u0438 \u0432\u0441\u0435 \u0432\u0430\u0448\u0438 \u0434\u0430\u043d\u043d\u044b\u0435."),n.a.createElement("p",null,"\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u0434\u043b\u044f \u0430\u0443\u0434\u0438\u0442\u0430 \u043d\u0430"," ",n.a.createElement("a",{target:"blank",href:"https://github.com/rlz/invest"},"GitHub"),"."),n.a.createElement("p",null,"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438\u0435 API \u0442\u043e\u043a\u0435\u043d\u0430 \u043e\u043f\u0438\u0441\u0430\u043d\u043e \u0432"," ",n.a.createElement("a",{target:"blank",href:"https://tinkoffcreditsystems.github.io/invest-openapi/auth/"},"\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u043a \xab\u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444 \u0418\u043d\u0432\u0435\u0441\u0442\u0438\u0446\u0438\u0438 OpenApi\xbb"),".")),n.a.createElement("div",{className:"disclaimer"},n.a.createElement("h1",null,"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435"),n.a.createElement("p",null,"\u0414\u0430\u043d\u043d\u043e\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u043c \u043f\u0440\u0438\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438\u0435\u043c \u0422\u0438\u043d\u044c\u043a\u043e\u0444\u0444, \u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u043e \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u043c \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u043e\u043c \u0432 \u0438\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u0446\u0435\u043b\u044f\u0445."),n.a.createElement("p",null,"\u0412\u0432\u043e\u0434\u044f \u0441\u0432\u043e\u0439 API \u0442\u043e\u043a\u0435\u043d \u0432\u044b \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435, \u0447\u0442\u043e \u043e\u0441\u043e\u0437\u043d\u0430\u0435\u0442\u0435 \u0432\u0441\u0435 \u0440\u0438\u0441\u043a\u0438, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0438 \u0431\u0435\u0440\u0435\u0442\u0435 \u0438\u0445 \u043d\u0430 \u0441\u0435\u0431\u044f."),n.a.createElement("p",null,'\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f "\u043a\u0430\u043a \u0435\u0441\u0442\u044c" \u0431\u0435\u0437 \u043a\u0430\u043a\u0438\u0445-\u043b\u0438\u0431\u043e \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0439 \u0438 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043d\u0435\u0434\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0438 \u043e\u0448\u0438\u0431\u043a\u0438 \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438, \u0437\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0430\u0432\u0442\u043e\u0440 \u043d\u0435 \u043d\u0435\u0441\u0435\u0442 \u043d\u0438\u043a\u0430\u043a\u043e\u0439 \u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u0438.')),n.a.createElement("form",null,n.a.createElement("input",{type:"text",value:this.state.token,onChange:function(t){return e.setState({token:t.target.value})},placeholder:"API \u0422\u043e\u043a\u0435\u043d",autoFocus:!0}),n.a.createElement("button",{type:"button",onClick:function(){return e.onLoginClick()}},"\u0412\u043e\u0439\u0442\u0438")))}},{key:"onLoginClick",value:function(){var e;""!==this.state.token&&(e=this.state.token,localStorage.setItem("API_TOKEN",e),this.props.onLoggedIn())}}]),a}(n.a.Component)),ie=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.cur,a=e.amount,r=e.usdPrice,i=e.eurPrice,c=e.color;return n.a.createElement(n.a.Fragment,null,n.a.createElement("td",{key:"total-rub",className:"all-cur"},n.a.createElement(L,{v:N(t,a,r,i),color:c})),n.a.createElement("td",{key:"total-usd",className:"all-cur"},n.a.createElement(z,{v:R(t,a,r,i),color:c})),n.a.createElement("td",{key:"total-eur",className:"all-cur"},n.a.createElement(W,{v:x(t,a,r,i),color:c})))}}]),a}(n.a.Component),ce=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("td",{key:"total-rub",className:"all-cur"}),n.a.createElement("td",{key:"total-usd",className:"all-cur"}),n.a.createElement("td",{key:"total-eur",className:"all-cur"}))}}]),a}(n.a.Component),oe=a(72),ue=a(128),se=a(100),le=a.n(se),de=(a(200),a(201),function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(d.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).uPlot=null,e.chartDiv=null,e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){if(null!==this.chartDiv){var e={width:this.chartDiv.clientWidth,height:this.chartDiv.clientHeight,class:"spark",cursor:{show:!1},legend:{show:!1},scales:{x:{time:!1}},axes:[{show:!1},{show:!1}],series:[{},{stroke:"#aaaaaa",fill:"#aaaaaa"}],fmtDate:function(){return function(){return""}}};this.uPlot=new J.a(e,this.data(),this.chartDiv)}}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.uPlot)||void 0===e||e.destroy(),this.uPlot=null}},{key:"componentDidUpdate",value:function(){var e;null===(e=this.uPlot)||void 0===e||e.setData(this.data())}},{key:"render",value:function(){var e=this,t=this.props.max.diff(this.props.min).as("days"),a=this.props.start.diff(this.props.min).as("days"),r=this.props.end.diff(this.props.min).as("days");return n.a.createElement("div",{className:"cDateRangeSelector"},n.a.createElement("div",{className:"dates"},n.a.createElement("div",{className:"from"},"\u0421",n.a.createElement(le.a,{dateFormat:"yyyy-MM-dd",selected:this.props.start.toJSDate(),onChange:function(t){return e.props.onChange(null!==t?f.DateTime.fromJSDate(t):e.props.min,e.props.end)}})),n.a.createElement("div",{className:"until"},"\u043f\u043e",n.a.createElement(le.a,{dateFormat:"yyyy-MM-dd",selected:this.props.end.toJSDate(),onChange:function(t){return e.props.onChange(e.props.start,null!==t?f.DateTime.fromJSDate(t):e.props.max)}}))),n.a.createElement("div",{className:"range-chart"},n.a.createElement("div",{className:"chart",ref:function(t){e.chartDiv=t}}),n.a.createElement(ue.a,{min:0,max:t,value:[a,r],onChange:function(t){var a=Object(oe.a)(t,2),r=a[0],n=a[1];return e.props.onChange(e.posToDate(r),e.posToDate(n))}})))}},{key:"posToDate",value:function(e){return this.props.min.plus(f.Duration.fromObject({days:e}))}},{key:"data",value:function(){var e,t=[],a=[],r=Object(o.a)(this.props.timeline);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.date.getTime());var i=new B(n.usdPrice,n.eurPrice);i.add("RUB",n.rub).add("USD",n.usd).add("EUR",n.eur);for(var c=0,u=Object.values(n.portfolio);c<u.length;c++){var s=u[c];i.add(s.currency,s.price*s.amount)}a.push(i.usd())}}catch(l){r.e(l)}finally{r.f()}return[t,a]}}]),a}(n.a.Component));function me(e){return void 0!==e.trades?e.trades.map((function(e){return e.quantity})).reduce((function(e,t){return e+t}),0):e.quantity}var pe=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state={expanded:!1},r}return Object(m.a)(a,[{key:"render",value:function(){var e,t,a,r=this,i=this.props,c=i.instruments,u=i.i,s=i.initDay,l=i.curDay,d=c[u.figi];if(void 0===d)throw Error("Unknown instrument");var m,p=null===s||void 0===s||null===(e=s.portfolio)||void 0===e?void 0:e[u.figi],v=(null!==(t=null===p||void 0===p?void 0:p.amount)&&void 0!==t?t:0)*(null!==(a=null===p||void 0===p?void 0:p.price)&&void 0!==a?a:0),h=u.amount*u.price-v,y=void 0===s?f.DateTime.fromMillis(0):f.DateTime.fromJSDate(s.date).plus({days:1}),E=Object(o.a)(u.ops);try{for(E.s();!(m=E.n()).done;){var b=m.value;if(!(f.DateTime.fromISO(b.date)<=y))if(b.operationType.startsWith("Buy")){var w=me(b);if(void 0===w)throw Error("undefined quantity");h-=b.price*w}else if("Sell"===b.operationType){var P=me(b);if(void 0===P)throw Error("undefined quantity");h+=b.price*P}else"Dividend"===b.operationType&&(h+=b.payment)}}catch(I){E.e(I)}finally{E.f()}var k,D,O,S,U=u.ops[u.ops.length-1],j=[n.a.createElement("tr",{key:u.figi,className:"inst-main-line"},n.a.createElement("td",{className:"name"},d.name),n.a.createElement("td",null,u.amount," ","\xd7"," ",n.a.createElement(q,{t:u.currency,v:u.price})," = ",n.a.createElement(q,{t:u.currency,v:u.amount*u.price})),n.a.createElement(ie,{cur:u.currency,amount:u.price*u.amount,usdPrice:l.usdPrice,eurPrice:l.eurPrice})),n.a.createElement("tr",{key:u.figi+"-sl",className:"inst-ticker-line"},n.a.createElement("td",{className:"ticker"},d.ticker),n.a.createElement("td",null,n.a.createElement(q,{t:u.currency,v:h,color:!0})),n.a.createElement(ie,{cur:u.currency,amount:h,usdPrice:l.usdPrice,eurPrice:l.eurPrice,color:!0}))];if(this.state.expanded){j.push(n.a.createElement("tr",{key:"expand-".concat(u.figi)},n.a.createElement("td",{colSpan:2},u.ops.length," \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439"," ",n.a.createElement("button",{onClick:function(){return r.setState({expanded:!1})}},n.a.createElement(C.a,{icon:T.e})," \u0421\u043a\u0440\u044b\u0442\u044c")),n.a.createElement(ce,null)));var N,R=Object(g.a)(u.ops).reverse(),x=Object(o.a)(R);try{for(x.s();!(N=x.n()).done;){var F=N.value;f.DateTime.fromISO(F.date)<=y||j.push(this.renderOperation(u,F,l.usdPrice,l.eurPrice))}}catch(I){x.e(I)}finally{x.f()}if(void 0!==s&&void 0!==p){var B=p;j.push(n.a.createElement("tr",{key:"initial",className:"op-line"},n.a.createElement("td",null,f.DateTime.fromJSDate(s.date).toISODate()," \u0432 \u043f\u043e\u0440\u0442\u0444\u0435\u043b\u0435"),n.a.createElement("td",null,B.amount," ","\xd7 ",n.a.createElement(q,{t:B.currency,v:B.price})," ","= ",n.a.createElement(q,{t:B.currency,v:B.amount*B.price})),n.a.createElement(ie,{cur:B.currency,amount:B.price*B.amount,usdPrice:l.usdPrice,eurPrice:l.eurPrice})))}}else 1===u.ops.length?(j.push(n.a.createElement("tr",{key:"expand-".concat(u.figi)},n.a.createElement("td",{colSpan:2},"1 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044f"),n.a.createElement(ce,null))),j.push(this.renderOperation(u,U,l.usdPrice,l.eurPrice))):(j.push(n.a.createElement("tr",{key:"expand-".concat(u.figi)},n.a.createElement("td",{colSpan:2},u.ops.length," ",(k=u.ops.length,D="\u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044f",O="\u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438",S="\u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439",k%10===1&&k%100!==11?D:k%10>=2&&k%10<=4&&(k%100<10||k%100>=20)?O:S)," ",n.a.createElement("button",{onClick:function(){return r.setState({expanded:!0})}},n.a.createElement(C.a,{icon:T.d})," \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435")),n.a.createElement(ce,null))),j.push(this.renderOperation(u,U,l.usdPrice,l.eurPrice)),j.push(n.a.createElement("tr",{key:"op-more-".concat(u.figi)},n.a.createElement("td",{colSpan:2},"..."),n.a.createElement("td",{colSpan:3,className:"all-cur"}))));return j}},{key:"renderOperation",value:function(e,t,a,r){if("Buy"===t.operationType||"BuyCard"===t.operationType||"Sell"===t.operationType){var i={Buy:n.a.createElement("span",null,n.a.createElement(C.a,{icon:T.b})," ",n.a.createElement(C.a,{icon:T.h})),BuyCard:n.a.createElement("span",null,n.a.createElement(C.a,{icon:T.b})," ",n.a.createElement(C.a,{icon:T.h})),Sell:n.a.createElement("span",null,n.a.createElement(C.a,{icon:T.h})," ",n.a.createElement(C.a,{icon:T.b}))}[t.operationType],c=me(t);if(void 0===c)throw Error("undefined quantity");return n.a.createElement("tr",{key:"".concat(e.figi,"-op-").concat(t.date,"-").concat(t.id),className:"op-line"},n.a.createElement("td",null,f.DateTime.fromISO(t.date).toISODate()," ",i),n.a.createElement("td",null,c," ","\xd7"," ",n.a.createElement(q,{t:t.currency,v:t.price})," ","= ",n.a.createElement(q,{t:t.currency,v:c*t.price})),n.a.createElement(ie,{cur:t.currency,amount:c*t.price,usdPrice:a,eurPrice:r}))}if("Dividend"===t.operationType)return n.a.createElement("tr",{key:"".concat(e.figi,"-op-").concat(t.date,"-").concat(t.id),className:"op-line"},n.a.createElement("td",null,f.DateTime.fromISO(t.date).toISODate()," ",n.a.createElement(C.a,{icon:T.f})),n.a.createElement("td",null,n.a.createElement(q,{t:t.currency,v:t.payment})),n.a.createElement(ie,{cur:t.currency,amount:t.payment,usdPrice:a,eurPrice:r}));throw Error("Unexpected operationType")}}]),a}(n.a.Component),ve=(a(259),function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state={startPosition:0,endPosition:e.timeline.length-1,expandedInstruments:new Set},r}return Object(m.a)(a,[{key:"render",value:function(){var e,t,a,r,i,c,o,u,s,l,d=this,m=this.props,p=m.timeline,v=m.instruments,h=p[this.state.startPosition-1],y=p[this.state.endPosition],E=new B(null!==(e=null===h||void 0===h?void 0:h.usdPrice)&&void 0!==e?e:1,null!==(t=null===h||void 0===h?void 0:h.eurPrice)&&void 0!==t?t:1);E.addRub(null!==(a=null===h||void 0===h?void 0:h.rub)&&void 0!==a?a:0).addUsd(null!==(r=null===h||void 0===h?void 0:h.usd)&&void 0!==r?r:0).addEur(null!==(i=null===h||void 0===h?void 0:h.eur)&&void 0!==i?i:0);for(var b=0,w=Object.values(null!==(g=null===h||void 0===h?void 0:h.portfolio)&&void 0!==g?g:{});b<w.length;b++){var g,P=w[b];E.add(P.currency,P.amount*P.price)}var k=new B(y.usdPrice,y.eurPrice);k.addRub(y.rub).addUsd(y.usd).addEur(y.eur);for(var D=0,O=Object.values(y.portfolio);D<O.length;D++){var S=O[D];k.add(S.currency,S.amount*S.price)}var U=new B(null!==(c=null===h||void 0===h?void 0:h.usdPrice)&&void 0!==c?c:1,null!==(o=null===h||void 0===h?void 0:h.eurPrice)&&void 0!==o?o:1).addRub(null!==(u=null===h||void 0===h?void 0:h.ownRub)&&void 0!==u?u:0).addUsd(null!==(s=null===h||void 0===h?void 0:h.ownUsd)&&void 0!==s?s:0).addEur(null!==(l=null===h||void 0===h?void 0:h.ownEur)&&void 0!==l?l:0),j=new B(y.usdPrice,y.eurPrice).addRub(y.ownRub).addUsd(y.ownUsd).addEur(y.ownEur).usd()-U.usd(),T=f.DateTime.fromJSDate(p[0].date),C=f.DateTime.fromJSDate(p[p.length-1].date),N=T.plus(f.Duration.fromObject({days:this.state.startPosition})),R=T.plus(f.Duration.fromObject({days:this.state.endPosition}));return n.a.createElement("div",{className:"bPortfolio"},n.a.createElement(de,{min:T,max:C,start:N,end:R,timeline:p,onChange:function(e,t){var a,r;d.setState({startPosition:null!==(a=d.dateToPos(e))&&void 0!==a?a:0,endPosition:null!==(r=d.dateToPos(t))&&void 0!==r?r:p.length-1})}}),n.a.createElement("h1",null,"\u041f\u043e\u043b\u043d\u0430\u044f \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u043f\u043e\u0440\u0442\u0444\u0435\u043b\u044f"),n.a.createElement("div",{className:"bPortfolio-full-cost"},n.a.createElement(L,{v:k.rub()}),n.a.createElement(z,{v:k.usd()}),n.a.createElement(W,{v:k.eur()}),n.a.createElement($,{v:(k.usd()-E.usd()-j)/k.usd(),color:!0})),n.a.createElement("table",null,n.a.createElement("tbody",null,this.renderOwnMoney(y),this.renderAvailable(y),n.a.createElement("tr",null,n.a.createElement("th",{colSpan:2,className:"th-first-line"},"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u044b"),n.a.createElement(ce,null)),I(y.portfolio,v,y.usdPrice,y.eurPrice).map((function(e){return n.a.createElement(pe,{key:e.figi,instruments:v,i:e,initDay:h,curDay:y})})))))}},{key:"renderAvailable",value:function(e){var t=function(t){var a=e.rub;return"USD"===t&&(a=e.usd),"EUR"===t&&(a=e.eur),n.a.createElement("tr",{key:"avail-".concat(t)},n.a.createElement("td",{colSpan:2},n.a.createElement(q,{t:t,v:a})),n.a.createElement(ie,{cur:t,amount:a,usdPrice:e.usdPrice,eurPrice:e.eurPrice}))},a=new B(e.usdPrice,e.eurPrice).addRub(e.rub).addUsd(e.usd).addEur(e.eur);return[n.a.createElement("tr",{key:"available-th"},n.a.createElement("th",{colSpan:2,className:"th-first-line"},"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e"),n.a.createElement(ce,null)),t("RUB"),t("USD"),t("EUR"),n.a.createElement("tr",{key:"available-total",className:"total"},n.a.createElement("th",{colSpan:2},"\u0412\u0441\u0435\u0433\u043e"),n.a.createElement(ie,{cur:"RUB",amount:a.rub(),usdPrice:e.usdPrice,eurPrice:e.eurPrice}))]}},{key:"renderOwnMoney",value:function(e){var t=function(t){var a=e[{RUB:"ownRub",USD:"ownUsd",EUR:"ownEur"}[t]];return n.a.createElement("tr",{key:"ownMoney-".concat(t.toLowerCase())},n.a.createElement("td",{colSpan:2},n.a.createElement(q,{t:t,v:a})),n.a.createElement(ie,{cur:t,amount:a,usdPrice:e.usdPrice,eurPrice:e.eurPrice}))},a=new B(e.usdPrice,e.eurPrice).addRub(e.ownRub).addUsd(e.ownUsd).addEur(e.ownEur);return[n.a.createElement("tr",{key:"ownMoney-th"},n.a.createElement("th",{colSpan:2,className:"th-first-line"},"\u0418\u043d\u0432\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e (\u0432\u044b\u0432\u0435\u0434\u0435\u043d\u043e)"),n.a.createElement("th",{colSpan:3,className:"all-cur"},"\u0412 \u0440\u0430\u0437\u043d\u044b\u0445 \u0432\u0430\u043b\u044e\u0442\u0430\u0445")),t("RUB"),t("USD"),t("EUR"),n.a.createElement("tr",{key:"ownMoney-total",className:"total"},n.a.createElement("th",{colSpan:2},"\u0412\u0441\u0435\u0433\u043e"),n.a.createElement(ie,{cur:"RUB",amount:a.rub(),usdPrice:e.usdPrice,eurPrice:e.eurPrice}))]}},{key:"dateToPos",value:function(e){var t=e.diff(f.DateTime.fromJSDate(this.props.timeline[0].date)).as("days");if(!(t<0||t>this.props.timeline.length-1))return t}}]),a}(n.a.Component)),fe=(a(260),function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.activeTab,a=e.usdPrice,r=e.eurPrice,i=e.onTabClick;return n.a.createElement("div",{className:"bTopPanel"},n.a.createElement("div",{className:M("tab",["PF"===t,"active-tab"]),onClick:function(){return i("PF")}},"\u041f\u043e\u0440\u0442\u0444\u0435\u043b\u044c"),n.a.createElement("div",{className:M("tab",["TL"===t,"active-tab"]),onClick:function(){return i("TL")}},"\u0418\u0441\u0442\u043e\u0440\u0438\u044f"),n.a.createElement("div",{className:"spacer"}),n.a.createElement("div",null,"USD: ",void 0===a?"?":n.a.createElement(L,{v:a})," ","EUR: ",void 0===r?"?":n.a.createElement(L,{v:r})),n.a.createElement("div",null,n.a.createElement("button",{onClick:this.props.onLogoutClick},"\u0412\u044b\u0439\u0442\u0438")),n.a.createElement("div",null,this.props.loading?n.a.createElement(C.a,{icon:T.g,pulse:!0}):n.a.createElement("button",{onClick:this.props.onReloadClick},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")))}}]),a}(n.a.Component)),he=a(127),ye=new Set(["PayIn","Tax","TaxBack","PayOut","MarginCommission"]),Ee="BBG0013HJJ31",be="BBG0013HGFT4";function we(e){var t=new Date(e);return t.setHours(0,0,0,0),t.setDate(t.getDate()+1),t}var ge=function(){function e(t,a,r){Object(d.a)(this,e),this.instrumentsMap=void 0,this.ops=void 0,this.candles=void 0,this.instrumentsMap=t,this.ops=a,this.candles=r}return Object(m.a)(e,[{key:"usdPrice",value:function(){return w(this.candles[be])}},{key:"eurPrice",value:function(){return w(this.candles[Ee])}},{key:"allInstruments",value:function(){var e,t=new Map,a=Object(o.a)(this.ops);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(!ye.has(r.operationType))if(void 0!==r.figi){if(r.figi!==be&&r.figi!==Ee&&!t.has(r.figi)){var n=this.instrumentsMap[r.figi];if(void 0===n){console.log("Unknown op figi",r);continue}t.set(r.figi,n)}}else console.log("Weird op figi",r)}}catch(i){a.e(i)}finally{a.f()}return Object(g.a)(t.values())}},{key:"timeline",value:function(){for(var e=[],t={rub:0,usd:0,eur:0,ownRub:0,ownUsd:0,ownEur:0},a={},r=0,n=function(e){var t=new Date(e);return t.setHours(0,0,0,0),t}(new Date(this.ops[0].date));n<we(new Date);n=we(n)){for(var i=we(n),c=[];;){var o=this.ops[r];if(void 0===o||new Date(o.date)>=i)break;if(r++,"Done"===o.status){t[o.currency.toLowerCase()]+=o.payment;var u=o.figi,s=me(o);if("Buy"===o.operationType||"BuyCard"===o.operationType){if(void 0===u)throw Error("undefined in op figi");if(void 0===s)throw Error("undefined in op quantity");if(u===be)t.usd+=s;else if(u===Ee)t.eur+=s;else if(void 0===a[u]){var l,d=null===(l=this.instrumentsMap[u])||void 0===l?void 0:l.currency;if(void 0===d)throw Error("Unknown instrument");a[u]={figi:u,amount:s,price:-1,currency:d,ops:[o]}}else a[u].amount+=s,a[u].ops.push(o)}if("Sell"===o.operationType){if(void 0===u)throw Error("undefined in op figi");if(void 0===s)throw Error("undefined in op quantity");if(u===be)t.usd-=s;else if(u===Ee)t.eur-=s;else if(void 0===a[u]){var m,p=null===(m=this.instrumentsMap[u])||void 0===m?void 0:m.currency;if(void 0===p)throw Error("Unknown instrument");a[u]={figi:u,amount:-s,price:-1,currency:p,ops:[o]}}else a[u].amount-=s,a[u].ops.push(o)}if("PayIn"!==o.operationType&&"PayOut"!==o.operationType||("RUB"===o.currency?t.ownRub+=o.payment:"USD"===o.currency?t.ownUsd+=o.payment:t.ownEur+=o.payment),"Dividend"===o.operationType){if(void 0===u)throw Error("undefined in op figi");a[u].ops.push(o)}c.push(o)}}for(var v=0,f=Object.values(a);v<f.length;v++){var h=f[v],y=this.candles[h.figi],E=b(y,i);if(void 0===E)throw console.log(h,y,we),Error("Can't find price");h.price=E}var w=b(this.candles[be],i);if(void 0===w)throw Error("Can't find USD price");var g=b(this.candles[Ee],i);if(void 0===g)throw Error("Can't find EUR price");e.push(Object(j.a)({},t,{date:n,portfolio:Object(he.deepCopy)(a),ops:c,usdPrice:w,eurPrice:g}))}return e}}]),e}(),Pe=function(e){Object(v.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state={loading:!1,activeTab:"PF"},r}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.loadData();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;if(null===h())return n.a.createElement(ne,{onLoggedIn:function(){e.loadData(),e.forceUpdate()}});var t=this.state,a=t.instrumentsMap,r=t.timeline,i=t.activeTab,c=void 0,o=void 0;if(void 0!==r&&r.length>0){var u=r[r.length-1];c=u.usdPrice,o=u.eurPrice}var s=n.a.createElement(fe,{loading:this.state.loading,activeTab:i,usdPrice:c,eurPrice:o,onTabClick:function(t){return e.setState({activeTab:t})},onReloadClick:function(){e.loadData()},onLogoutClick:function(){localStorage.removeItem("API_TOKEN"),e.setState({instrumentsMap:void 0,ops:void 0,candles:void 0})}});return void 0===a||void 0===r?n.a.createElement("div",{className:"cApp"},s,n.a.createElement("div",{className:"cApp-body"})):"PF"===i?n.a.createElement("div",{className:"cApp"},s,n.a.createElement("div",{className:"cApp-body"},n.a.createElement(ve,{instruments:a,timeline:r}))):n.a.createElement("div",{className:"cApp"},s,n.a.createElement("div",{className:"cApp-body"},n.a.createElement(re,{instruments:a,states:r})))}},{key:"loadData",value:function(){var e=Object(l.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==h()){e.next=2;break}return e.abrupt("return");case 2:return this.setState({loading:!0}),e.prev=3,e.delegateYield(s.a.mark((function e(){var a,r,n,i,c,u,d,m,p,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:return a=e.sent,e.next=5,S();case 5:r=e.sent,n=new ge(a,r,{}),i={},c=[],u=f.DateTime.fromISO(r[0].date).minus({hours:168}).toJSDate(),d=Object(o.a)(n.allInstruments());try{for(p=function(){var e=m.value;c.push(Object(l.a)(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y(e.figi,u);case 2:a=t.sent,i[e.figi]=a;case 4:case"end":return t.stop()}}),t)})))())},d.s();!(m=d.n()).done;)p()}catch(h){d.e(h)}finally{d.f()}return c.push(Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(be,u);case 2:t=e.sent,i[be]=t;case 4:case"end":return e.stop()}}),e)})))()),c.push(Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(Ee,u);case 2:t=e.sent,i[Ee]=t;case 4:case"end":return e.stop()}}),e)})))()),e.next=16,Promise.all(c);case 16:v=new ge(a,r,i).timeline(),t.setState({instrumentsMap:a,ops:r,candles:i,timeline:v});case 18:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:return e.prev=5,this.setState({loading:!1}),e.finish(5);case 8:case"end":return e.stop()}}),e,this,[[3,,5,8]])})));return function(){return e.apply(this,arguments)}}()}]),a}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(n.a.createElement(Pe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[129,1,2]]]);
//# sourceMappingURL=main.98251b1d.chunk.js.map